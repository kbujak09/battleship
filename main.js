(()=>{"use strict";const t=t=>{let e=0;return{length:t,hit:()=>e++,hitCount:()=>e,isSunk:()=>e>=t}},e=()=>{const e=(()=>{const e=[],r=()=>e,o=[],a=()=>o,s=[],c=[];return{board:o,getBoard:a,getShips:()=>{const t=[];return a().forEach((e=>{e.position.forEach((e=>{t.push(e)}))})),t},addShip:(a,s,c,d)=>{if(!("vertical"==d&&s+1<a||"horizontal"==d&&c+a>9)){let i=[];if("vertical"==d)for(let t=0;t<a;t++)i.push([s-t,c]);else if("horizontal"==d)for(let t=0;t<a;t++)i.push([s,c+t]);for(let t of i)for(let e of r())if(e.toString()==t.toString())return;const l={deck:t(a),position:i};o.push(l);for(let t of l.position)e.push([t[0]+1,t[1]-1],[t[0]+1,t[1]],[t[0]+1,t[1]+1],[t[0],t[1]-1],[t[0],t[1]],[t[0],t[1]+1],[t[0]-1,t[1]-1],[t[0]-1,t[1]],[t[0]-1,t[1]+1]);return l}},getMissed:()=>s,receiveAttack:t=>{for(let e of a())e.position.forEach((r=>{if(r.toString()==t)return c.push(t),e.deck.hit()}));s.push(t)},getOccupied:r,isOver:()=>{for(let t of a())if(!t.deck.isSunk())return!1;return!0},getHits:()=>c}})(),r=[];for(let t=0;t<10;t++)for(let e=0;e<10;e++)r.push([t,e]);return{board:e,attack:(t,e)=>{t.board.receiveAttack(e)},getRandomSquare:()=>r.splice(Math.floor(Math.random()*r.length),1)}},r=document.querySelector("#result"),o=t=>{document.querySelector("#computerBoard"),document.querySelector("#playerBoard");for(let e=9;e>=0;e--)for(let r=0;r<10;r++){const o=document.createElement("div");"computerBoard"==t.id?(o.classList.add("computerSqr"),o.dataset.computer=[e,r]):(o.classList.add("playerSqr"),o.dataset.player=[e,r]),o.classList.add("sqr"),t.appendChild(o)}},a=t=>{const e=t=>Math.floor(Math.random()*t),r=[2,3,4,4,5];for(;t.getBoard().length<5;)t.addShip(r[r.length-1],e(9),e(9),1==Math.floor(2*Math.random())?"horizontal":"vertical")&&r.pop()},s=(t,e)=>{const r=document.querySelectorAll(".playerSqr"),o=document.querySelectorAll(".computerSqr");r.forEach((t=>{t.dataset.player==e&&(t.classList.contains("playerShip")?t.classList.add("hit"):t.classList.add("miss"))})),o.forEach((e=>{e.dataset.computer==t&&(e.classList.contains("computerShip")?e.classList.add("hit"):e.classList.add("miss"))}))},c=e(),d=e();a(d.board),a(c.board),o(playerBoard),o(computerBoard),((t,e)=>{const r=document.querySelectorAll(".playerSqr"),o=document.querySelectorAll(".computerSqr");r.forEach((e=>{for(let r of t)r==e.dataset.player&&e.classList.add("playerShip")})),o.forEach((t=>{for(let r of e)r==t.dataset.computer&&t.classList.add("computerShip")}))})(c.board.getShips(),d.board.getShips()),((t,e)=>{document.querySelectorAll(".computerSqr").forEach((o=>{o.addEventListener("click",(()=>{((t,e,r)=>{t.attack(e,[r.target.dataset.computer[0],r.target.dataset.computer[2]]),s([r.target.dataset.computer[0],r.target.dataset.computer[2]],void 0);let o=t.getRandomSquare();e.attack(t,o),setInterval((()=>{s([r.target.dataset.computer[0],r.target.dataset.computer[2]],o)}),200)})(t,e,event),setTimeout((()=>{t.board.isOver()?(r.innerText="computer won!",document.addEventListener("click",(()=>{window.location.reload()}))):e.board.isOver()&&(r.innerText="player won!",document.addEventListener("click",(()=>{window.location.reload()})))}),10)}),{once:!0})})),setTimeout((()=>{t.board.isOver()?r.innerText="computer won!":e.board.isOver()&&(r.innerText="player won!")}),10)})(c,d)})();